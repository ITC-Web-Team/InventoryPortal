(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[134],{5080:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/inventory/[id]",function(){return s(8742)}])},2206:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});let a=(0,s(2092).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},5310:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});let a=(0,s(2092).Z)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]])},2138:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});let a=(0,s(2092).Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},4609:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});let a=(0,s(2092).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},6567:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});let a=(0,s(2092).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},8742:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>p});var a=s(2433),l=s(609),r=s(8143),n=s(7259),i=s(2206);let d=(0,s(2092).Z)("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);var c=s(4609),o=s(445),u=s(2138),m=s(5310),x=s(6567),h=s(750),y=s.n(h);function p(){let e=(0,r.useRouter)(),{id:t}=e.query,[s,h]=(0,l.useState)(null),[p,g]=(0,l.useState)(!0),[b,f]=(0,l.useState)(null),[v,j]=(0,l.useState)(""),[N,w]=(0,l.useState)(1),[k,Z]=(0,l.useState)([]),[I,E]=(0,l.useState)(!1),[S,q]=(0,l.useState)(!1),[C,_]=(0,l.useState)(!1);(0,l.useEffect)(()=>{_(!0);let e=localStorage.getItem("userdata");e&&q(JSON.parse(e).isAdmin);let s=async()=>{if(!t||"undefined"===t||"null"===t){f("Invalid item ID"),g(!1);return}try{let e=await n.Z.get("/api/inventory/".concat(t));e.data?h(e.data):f("Item not found")}catch(e){console.error("Error fetching item details:",e),f("Failed to fetch item details")}finally{g(!1)}};t&&s()},[t,e]),(0,l.useEffect)(()=>{(async()=>{if(t)try{let e=await n.Z.get("/api/inventory/".concat(t,"/issues"));Z(e.data)}catch(e){console.error("Error fetching item issues:",e)}})()},[t]);let F=async()=>{try{if((await n.Z.post("/api/issues/create",{inventoryId:t,rollNumber:v,quantity:N})).data){let e=await n.Z.get("/api/inventory/".concat(t,"/issues"));Z(e.data),j(""),w(1),alert("Item issued successfully!")}}catch(t){var e,s;console.error("Error issuing item:",t),alert((null===(s=t.response)||void 0===s?void 0:null===(e=s.data)||void 0===e?void 0:e.message)||"Failed to issue item")}},M=async e=>{try{if((await n.Z.post("/api/issues/return",{issueId:e})).data){let[e,s]=await Promise.all([n.Z.get("/api/inventory/".concat(t)),n.Z.get("/api/inventory/".concat(t,"/issues"))]);h(e.data),Z(s.data),alert("Item returned successfully!")}}catch(e){var s,a;console.error("Error returning item:",e),alert((null===(a=e.response)||void 0===a?void 0:null===(s=a.data)||void 0===s?void 0:s.message)||"Failed to return item")}},D=async()=>{if(window.confirm("Are you sure you want to delete this item? This action cannot be undone.")){E(!0);try{let s=await n.Z.delete("/api/inventory/".concat(t));200===s.status&&(alert("Item deleted successfully!"),e.push("/inventory"))}catch(e){var s,a;console.error("Error deleting item:",e),alert((null===(a=e.response)||void 0===a?void 0:null===(s=a.data)||void 0===s?void 0:s.message)||"Failed to delete item")}finally{E(!1)}}};return C?p?(0,a.jsx)("div",{className:"flex justify-center items-center min-h-screen",children:(0,a.jsx)("div",{className:"animate-spin w-10 h-10 border-4 border-blue-500 rounded-full border-t-transparent"})}):b||!s?(0,a.jsxs)("div",{className:"text-center py-12 min-h-screen flex flex-col items-center justify-center",children:[(0,a.jsx)("p",{className:"text-gray-500 mb-4",children:b||"Item not found"}),(0,a.jsx)("button",{onClick:()=>e.push("/inventory"),className:"btn-primary",children:"Back to Inventory"})]}):(0,a.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[(0,a.jsxs)("button",{onClick:()=>e.push("/inventory"),className:"btn-outline flex items-center",children:[(0,a.jsx)(i.Z,{className:"w-5 h-5 mr-2"}),"Back to Inventory"]}),S&&(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsxs)("button",{className:"btn-yellow flex items-center",onClick:()=>e.push("/inventory/edit/".concat(t)),children:[(0,a.jsx)(d,{className:"w-5 h-5 mr-2"}),"Edit"]}),(0,a.jsx)("button",{className:"btn-danger flex items-center gap-2 px-4 py-2",onClick:D,disabled:I,children:I?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"animate-spin w-5 h-5 border-2 border-white rounded-full border-t-transparent"}),(0,a.jsx)("span",{children:"Deleting..."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(c.Z,{className:"w-5 h-5"}),(0,a.jsx)("span",{children:"Delete Item"})]})})]})]}),(0,a.jsxs)("div",{className:"grid md:grid-cols-2 gap-8",children:[(0,a.jsx)("div",{className:"relative w-full h-96",children:(0,a.jsx)(y(),{src:s.img||"/img/default-item.png",alt:s.title,fill:!0,className:"object-contain rounded-2xl border border-gray-200 shadow-lg",onError:e=>{e.target.src="/img/default-item.png"}})}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-800 mb-4",children:s.title}),0===s.quantity?(0,a.jsx)("span",{className:"px-3 py-1 bg-red-50 text-red-600 rounded-full text-sm border border-red-200",children:"Out of Stock"}):-1===s.quantity?(0,a.jsx)("span",{className:"px-3 py-1 bg-green-50 text-green-600 rounded-full text-sm border border-green-200",children:"Available"}):(0,a.jsxs)("span",{className:"px-3 py-1 bg-blue-50 text-blue-600 rounded-full text-sm border border-blue-200",children:[s.quantity," Available"]})]}),(0,a.jsx)("p",{className:"text-gray-600 mb-6",children:s.description||"No description available"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[(0,a.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center mb-2",children:[(0,a.jsx)(o.Z,{className:"w-5 h-5 mr-2 text-blue-500"}),(0,a.jsx)("span",{className:"font-semibold",children:"Quantity"})]}),(0,a.jsx)("p",{className:"text-gray-700",children:-1===s.quantity?"Unlimited":s.quantity})]}),(0,a.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center mb-2",children:[(0,a.jsx)(u.Z,{className:"w-5 h-5 mr-2 text-green-500"}),(0,a.jsx)("span",{className:"font-semibold",children:"Returnable"})]}),(0,a.jsx)("p",{className:"text-gray-700",children:s.returnable?"Yes":"No"})]})]}),S&&(0,a.jsxs)("div",{className:"mt-6 bg-gray-50 p-4 rounded-lg",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Issue Item"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("input",{type:"text",placeholder:"Roll Number",value:v,onChange:e=>j(e.target.value),className:"form-input w-full",required:!0}),-1!==s.quantity&&(0,a.jsx)("input",{type:"number",placeholder:"Quantity",value:N,onChange:e=>{let t=parseInt(e.target.value);w(t>0?t:1)},min:"1",max:s.quantity,className:"form-input w-full"}),(0,a.jsx)("button",{onClick:F,disabled:!v||0===s.quantity,className:"btn-primary w-full",children:"Issue Item"})]})]}),S&&(0,a.jsxs)("div",{className:"mt-8",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Issue History"}),0===k.length?(0,a.jsx)("p",{className:"text-gray-500",children:"No issues found for this item"}):(0,a.jsx)("div",{className:"space-y-4",children:k.map(e=>(0,a.jsxs)("div",{className:"bg-white border rounded-lg p-4 flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"font-medium",children:["Roll Number: ",e.rollNumber]}),(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:["Quantity: ",e.quantity," | Date: ",new Date(e.issueDate).toLocaleDateString()]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("span",{className:"\n                        px-2 py-1 rounded-full text-xs flex items-center gap-1\n                        ".concat(e.returned?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800","\n                      "),children:e.returned?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(m.Z,{className:"w-3 h-3"}),"Returned"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(x.Z,{className:"w-3 h-3"}),"Pending"]})}),!e.returned&&S&&(0,a.jsx)("button",{onClick:()=>M(e.id),className:"btn-outline text-sm py-1 px-3 hover:bg-green-50",children:"Return"})]})]},e.id))})]})]})]})]}):null}}},e=>{var t=t=>e(e.s=t);e.O(0,[211,690,888,774,179],()=>t(5080)),_N_E=e.O()}]);